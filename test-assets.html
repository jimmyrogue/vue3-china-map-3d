<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èµ„æºåŠ è½½æµ‹è¯• - Vue3 China Map 3D</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #2196F3;
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #45a049;
    }
    .image-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .image-card {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      background: white;
    }
    .image-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 4px;
    }
    .image-card .status {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
    }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ—ºï¸ Vue3 China Map 3D - èµ„æºåŠ è½½æµ‹è¯•</h1>

    <div class="test-section">
      <h2>ğŸ“ å½“å‰ç¯å¢ƒä¿¡æ¯</h2>
      <div id="env-info"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ”§ èµ„æºè·¯å¾„é…ç½®</h2>
      <p>å½“å‰èµ„æºåŸºç¡€è·¯å¾„ï¼š<code id="base-path">é»˜è®¤ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰</code></p>
      <div>
        <input type="text" id="custom-path" placeholder="è¾“å…¥è‡ªå®šä¹‰è·¯å¾„ï¼Œä¾‹å¦‚ï¼š/static/assets" style="width: 400px; padding: 8px;">
        <button onclick="setCustomPath()">è®¾ç½®è‡ªå®šä¹‰è·¯å¾„</button>
        <button onclick="resetPath()">é‡ç½®ä¸ºé»˜è®¤</button>
      </div>
    </div>

    <div class="test-section">
      <h2>ğŸ§ª èµ„æº URL ç”Ÿæˆæµ‹è¯•</h2>
      <button onclick="testUrlGeneration()">æµ‹è¯• URL ç”Ÿæˆ</button>
      <div id="url-test-results"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ–¼ï¸ å›¾ç‰‡åŠ è½½æµ‹è¯•</h2>
      <button onclick="testImageLoading()">æµ‹è¯•å›¾ç‰‡åŠ è½½</button>
      <div id="image-test-results"></div>
      <div id="image-preview" class="image-preview"></div>
    </div>

    <div class="test-section">
      <h2>ğŸ“Š æµ‹è¯•æŠ¥å‘Š</h2>
      <div id="test-report"></div>
    </div>
  </div>

  <script type="module">
    // æ¨¡æ‹Ÿèµ„æº URL ç”Ÿæˆé€»è¾‘ï¼ˆä¸å®é™…åŒ…ä¸­çš„é€»è¾‘ä¸€è‡´ï¼‰
    let customBasePath = null;

    function getAssetUrl(path) {
      if (customBasePath) {
        return `${customBasePath}/${path}`;
      }

      // æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„è·¯å¾„ç”Ÿæˆ
      const currentUrl = window.location.href;
      const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/'));
      return `${baseUrl}/dist/assets/${path}`;
    }

    // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
    function showEnvInfo() {
      const info = {
        'URL': window.location.href,
        'Protocol': window.location.protocol,
        'Host': window.location.host,
        'Pathname': window.location.pathname,
        'User Agent': navigator.userAgent.split(' ').slice(-2).join(' ')
      };

      const html = Object.entries(info).map(([key, value]) =>
        `<div class="test-result info"><strong>${key}:</strong> ${value}</div>`
      ).join('');

      document.getElementById('env-info').innerHTML = html;
    }

    // è®¾ç½®è‡ªå®šä¹‰è·¯å¾„
    window.setCustomPath = function() {
      const input = document.getElementById('custom-path');
      customBasePath = input.value.trim();
      document.getElementById('base-path').textContent = customBasePath || 'é»˜è®¤ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰';

      const result = document.createElement('div');
      result.className = 'test-result success';
      result.textContent = `âœ… å·²è®¾ç½®è‡ªå®šä¹‰è·¯å¾„: ${customBasePath}`;
      document.getElementById('url-test-results').prepend(result);
    };

    // é‡ç½®è·¯å¾„
    window.resetPath = function() {
      customBasePath = null;
      document.getElementById('custom-path').value = '';
      document.getElementById('base-path').textContent = 'é»˜è®¤ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰';

      const result = document.createElement('div');
      result.className = 'test-result info';
      result.textContent = 'ğŸ”„ å·²é‡ç½®ä¸ºé»˜è®¤è·¯å¾„';
      document.getElementById('url-test-results').prepend(result);
    };

    // æµ‹è¯• URL ç”Ÿæˆ
    window.testUrlGeneration = function() {
      const testPaths = [
        'textures/zhejiang/baseColor.png',
        'textures/zhejiang/normal.jpg',
        'images/city/hangzhou.jpg',
        'images/city/ningbo.jpg',
        'geo/zhejiang.json'
      ];

      const results = testPaths.map(path => {
        const url = getAssetUrl(path);
        return `
          <div class="test-result info">
            <strong>è·¯å¾„:</strong> ${path}<br>
            <strong>ç”Ÿæˆçš„ URL:</strong> <code>${url}</code>
          </div>
        `;
      }).join('');

      document.getElementById('url-test-results').innerHTML = results;
    };

    // æµ‹è¯•å›¾ç‰‡åŠ è½½
    window.testImageLoading = function() {
      const testImages = [
        { name: 'æµ™æ±Ÿåº•è‰²', path: 'textures/zhejiang/baseColor.png' },
        { name: 'æµ™æ±Ÿæ³•çº¿', path: 'textures/zhejiang/normal.jpg' },
        { name: 'æ­å·çº¹ç†', path: 'images/city/hangzhou.jpg' },
        { name: 'å®æ³¢çº¹ç†', path: 'images/city/ningbo.jpg' }
      ];

      const resultsDiv = document.getElementById('image-test-results');
      const previewDiv = document.getElementById('image-preview');

      resultsDiv.innerHTML = '<div class="test-result info">â³ æ­£åœ¨æµ‹è¯•å›¾ç‰‡åŠ è½½...</div>';
      previewDiv.innerHTML = '';

      let successCount = 0;
      let errorCount = 0;
      const totalCount = testImages.length;

      testImages.forEach(({ name, path }) => {
        const url = getAssetUrl(path);
        const img = new Image();

        const card = document.createElement('div');
        card.className = 'image-card';
        card.innerHTML = `
          <img src="${url}" alt="${name}">
          <div class="status">â³ åŠ è½½ä¸­...</div>
          <div style="font-size: 11px; color: #666; margin-top: 5px; word-break: break-all;">${path}</div>
        `;
        previewDiv.appendChild(card);

        img.onload = function() {
          successCount++;
          card.querySelector('.status').innerHTML = 'âœ… åŠ è½½æˆåŠŸ';
          card.querySelector('.status').style.color = '#155724';
          updateReport();
        };

        img.onerror = function() {
          errorCount++;
          card.querySelector('.status').innerHTML = 'âŒ åŠ è½½å¤±è´¥';
          card.querySelector('.status').style.color = '#721c24';
          card.querySelector('img').style.display = 'none';
          updateReport();
        };

        img.src = url;
      });

      function updateReport() {
        if (successCount + errorCount === totalCount) {
          const resultClass = errorCount === 0 ? 'success' : 'error';
          resultsDiv.innerHTML = `
            <div class="test-result ${resultClass}">
              <strong>æµ‹è¯•å®Œæˆ</strong><br>
              âœ… æˆåŠŸ: ${successCount} / ${totalCount}<br>
              âŒ å¤±è´¥: ${errorCount} / ${totalCount}
            </div>
          `;

          // æ›´æ–°æ€»æŠ¥å‘Š
          const reportDiv = document.getElementById('test-report');
          if (errorCount === 0) {
            reportDiv.innerHTML = `
              <div class="test-result success">
                <h3>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</h3>
                <p>èµ„æºè·¯å¾„é…ç½®æ­£ç¡®ï¼Œæ‰€æœ‰å›¾ç‰‡éƒ½èƒ½æ­£å¸¸åŠ è½½ã€‚</p>
              </div>
            `;
          } else {
            reportDiv.innerHTML = `
              <div class="test-result error">
                <h3>âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥</h3>
                <p>æœ‰ ${errorCount} ä¸ªèµ„æºæ— æ³•åŠ è½½ã€‚è¯·æ£€æŸ¥ï¼š</p>
                <ul>
                  <li>èµ„æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨äº <code>dist/assets/</code> ç›®å½•</li>
                  <li>èµ„æºè·¯å¾„é…ç½®æ˜¯å¦æ­£ç¡®</li>
                  <li>æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®é…ç½®äº†é™æ€èµ„æºè®¿é—®</li>
                  <li>æ˜¯å¦å­˜åœ¨ CORS é—®é¢˜</li>
                </ul>
                <p>æŸ¥çœ‹æµè§ˆå™¨ Console å’Œ Network æ ‡ç­¾è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
              </div>
            `;
          }
        }
      }
    };

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
    showEnvInfo();
  </script>
</body>
</html>
